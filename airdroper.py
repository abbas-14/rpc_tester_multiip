import os


from web3 import Web3
from web3.exceptions import TimeExhausted
from eth_account import Account
from dotenv import load_dotenv
import time
load_dotenv()


RPC_URL = os.getenv('RPC_URL')
MAIN_ACC = os.getenv('MAIN_ACC')
AIRDROP_AMT = os.getenv('AIRDROP_AMT')
MAIN_ACC_PVT_KEY = os.getenv('MAIN_ACC_PVT_KEY')

addrList = [
    '0x4F3e30bA207BD8f226A5676b5bba7cB41279fD35',
    '0x66d1F638D2a95CF0587A4B665CE0b612477ea655',
    '0xEDdd3d22f257b6c03e5455FEc74A9130ED6EF1C4',
    '0x7F428e67eb57ec47D52Dc5A9bb3c7754271E5c13',
    '0xCD0774429Ea88ac38FeD399E56dcE3a7B3E8B261',
    '0x0936bb1E3e0ed84FE29be0319d04603F0ED2F5aD',
    '0x85CD48BC8204b2e3Dd167db61dB85Eb558548D82',
    '0xB5F2C22dC8967D38b4389543E56dD04FCcA1BB22',
    '0xB5b2F32479B78d08A1ecf4d89bC41B24B699358a',
    '0xfdd091ECbaB890Ab9f77c80fE043847599fb53Fe',
    '0x550098C5d10591f2d631EE70A9f8B207bd940a51',
'0x08b356Cb6aFC9F0bcfdA27711f9Fb03cA604435f',
'0x758Fc789fa23007C5B4bd01A430113c7c78B67cf',
'0xa934146F40BcB41975cc8fCfb2509df976aEbFDD',
'0xd366c4Fc48f9A64AC0FEf7bcE15730e10e6b91FB',
'0xB5D2baC0Ee4e8a9A78b575462e521F90926E7A07',
'0xd9259Ac05fC869f0d68863F269569776FEe0484e',
'0x5b9ee1E7CDDe5d2997426CC2e083d3633288c34E',
'0x30246Ecbe16064bA00bF2f7e201E6Ce4e4A6e400',
'0x47c67467b167fb88f4bD8866273ab6F1F95db90B',
'0xF2048EBA66417da5161574B9f737Dd9592495967',
'0x2DF60707FCcfF398bCb88cb4FB8C838567d11397',
'0xDc56f1318d691913942Ce991604D60A7002Cbd4d',
'0xAb1C7EeE5fFd56EF042B64eC5b1a6F75291F3E11',
'0xC74901Acce79fA21452e51D17E8b474b772d60af',
'0x0926d8a0AAd75505968B756Fd192083E88fE0601',
'0x027f551eEFf277619006d2E563ee761d357ba847',
'0xEdc975e440892024933Ee63286a08c6A446D11D1',
'0x6CB9E9c398eeD21D83399e1Fca381a2D3a1ac17a',
'0xBA8d87c05BBf23567902Eeb05B6D50a2Cfc8b647',
'0x6A816974e550cf3410849e1D85B9006f0Fc6B120',
'0xf5dD18798ec8f02C105248794E30520f85aFEf30',
'0x109788dD96E1A7442f2eE4B43FCE1cED8224986b',
'0xCA4DE4342db21D52c91255113494d42e829C94EF',
'0xc9C353eBe4B295DFC78304Da1F0a2953B5EE1c93',
'0xecb118Cdb33d8E7dcAb07eCE29fbE68880Ab927c',
'0xb3A5662790b70922Cd19C74c6FC2454B92F73d3a',
'0x9adc283652B7B40C49A9990b5E9DA2A347dcCE68',
'0xd1c14502a9Cf27BEf2396BAF4324d7A73474b3dF',
'0x11099d9b64FD50213BDf78861c9D2c7f72fE36CC',
'0xEa7274b1404aDc6C42ea4A4F0acF59b4A59F1e3b',
'0xD52170E8e922568f6046b975F6C65deC99d9D8e6',
'0x4336269AE0d743d31D9047A88Bc46d2A2CA57Be5',
'0x81af77f63B34BF1c8Bc2BDd2AbfE2126D092EA6C',
'0xe612DA4b1c4Bc63CfB776028188029B1e76C8923',
'0x0899fBfd0a23c9FC6DEb57E93C73b3022fa6D8B0',
'0xcCA3145C94e20A7E49cF69C96778fBceFFDBBA72',
'0xCbcbb71Ab0bCc01aaF8Bac6a6cC1a498a9152641',
'0x575b756A453ACe3597153f1342EFa3ed23378651',
'0x56d52e472992C9188C3D6289D74F9c19D9a8623f',
'0x3da5044cd0C5c9eceF8C40E7E19Eeab0476F4F6D',
'0x81dE7315dFA08AfD39861a1d4FB8F9D4d6c66984',
'0xFa371CE97d77b4adD8F181Cf59d92E54A952c686',
'0xAF1515308c46a3CDE5BD4E5D8AEa8B34252f980c',
'0x7415b87bD5d9D96BA47f8e9d6442d31e83Acd5B6',
'0xc377920e0C4Ba2122B51CB9cB25d3BC52b40B05B',
'0x768e97d2F594A30B16B6b454339B1E5a322Bf9bE',
'0xba1E5711439e2e300feA349c0Eb17AaC146A1C94',
'0x37E1AFAE543135e90a44Be93Dc392D552d232DA3',
'0x925956990D827aFaAA72B7539a5ceec84c24B5AA',
'0xED3687124E0f9866f27b9adf3f407e3e581147A6',
'0x0c47b0B044001612A8177323f8b67b41Fba4158e',
'0x787a577F6722482a4fd1785a003e9ecCF46e1eb7',
'0x8E7Bc67192797044dEa95DAfBC1F952fC005D31e',
'0x6165b0bD6327feA18670F7c4d58669bB6a52D5eC',
'0xCEF591CB4796bb2e1BfA30DE221841c4b96A76C5',
'0x130321174A7a49317c3A5904b377b5cd2283f563',
'0x33E5f6445D7E1d1170d95A59d553A4C78cCE7F27',
'0xAc37A06E1bFa2C00A361226cf5056Fc18B789cFF',
'0x67548C0d093F4c1f9Cdc84417a55564D8742Cb27',
'0xA55d582581a5eB77bF056365274eb114C46b2935',
'0x14f236861Ccf7AA5F300654f6fB220C5285Bef58',
'0x84C6e8287414e5876Dada4F2771913dCaF77C305',
'0x6cb10ab463F4008303AF50EAdf4deC04f472f1A9',
'0x1912632685b037966646f2B883351a2d2B1AAE21',
'0xc639141C6B9a0e2BCDD4e3f029Fa2dA0255ccF47',
'0xbF05B872efB7d8f86735439aD4308C8A0C5daAA5',
'0xDD7CB3ef2d6308aFa37f0a872D0AC7749AfaFb9D',
'0x2d9A862996568b57543B5971078851Db7F3F74Eb',
'0x88a6978230B467Ce91e5F72432D2aF6b52dcB840',
'0xdB3B5d1805B9043995b4784B26063143b64A0Ce4',
'0x8f9e9e1d44643784dFAb9233e7e93f179a717Bfa',
'0x3a30c75373AdDFcA928DCd3382c322205E733F62',
'0x3e6f28a2313CAf7fDc9FAEfa3e28BB9CCF34f4D2',
'0x06a121BeeB2865825E386c6Ab8B5dddf59f320E7',
'0xbF4195CccEC0a4Afc3A988689dab2e25B8191647',
'0x6C6e525045DB4188751B4AebeA2a9D344E58bCee',
'0xA253cA11de0286B3d9696077661907DF56525B17',
'0xeD270E35D76F4D70Fd0bF2CbA252Ba99F0048847',
'0xdA1c6E001c892dc50B576bF38eC62A7689919CED',
'0xc19E33A067A2b5b27FA3061FC2dc700f7a637081',
'0x662B1C8D46Fed3E671c77A79f104204c5bd780c1',
'0xeF47f41Db5D22442cA33195f7671853F27d8E74c',
'0x45Bf84db3A185567b249Af7337E84c3d2355431D',
'0xbcc975008Df212E7A188C433C89f98Eb0b93a29C',
'0xa5277Dcc652Bed59b3982A2bFB5801159629CcA7',
'0x2b88f7Bc3899c462bD8605b908085B1e8972386E',
'0xD09b13CB2b464A6329017b9EA471A676e7772593',
'0xBA840c9eac6Dc650806a0895B992B047C5639617',
'0x252deF7CD8468101b94B74c6Cc10F01Dc759082e',
]

def createTxn(web3, rcvAddr, i):
    txn = {
        'to': rcvAddr,
        'value': web3.to_wei(AIRDROP_AMT, 'ether'),
        'gas': 21000,
        'gasPrice': (web3.eth.gas_price + 1000 * i),
        'nonce': web3.eth.get_transaction_count(MAIN_ACC),
    }
    return txn

def airdropCoins():
    web3 = Web3(Web3.HTTPProvider(RPC_URL))
    
    sender = Account.from_key(MAIN_ACC_PVT_KEY)
    print('0.001 ETH: ', web3.to_wei('0.001', 'ether'))
    l = len(addrList)
    i = 0
    while i < l:
        try:
            addr = addrList[i]
            txn = createTxn(web3, addr, i)
            signedTxn = web3.eth.account.sign_transaction(txn, sender.key)
            print('sending amount to ', addr, txn['nonce'], txn['gasPrice'], txn['value'])
            txHash = web3.eth.send_raw_transaction(signedTxn.rawTransaction)
            print('tx hash: ', txHash)
            print('waiting for the txn receipt..')
            # time.sleep(1)
            web3.eth.wait_for_transaction_receipt(txHash)
            print('received.')
            i += 1
        except (ValueError, TimeExhausted) as e:
            continue
    pass


def main():  
    airdropCoins()
    # web3 = Web3(Web3.HTTPProvider(RPC_URL))
    # print(web3.eth.gas_price)

if __name__ == '__main__':
    main()